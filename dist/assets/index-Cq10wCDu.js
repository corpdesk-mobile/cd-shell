const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/url-Dd-DREE4.js","assets/__vite-browser-external-D7Ct-6yo.js"])))=>i.map(i=>d[i]);
var A=Object.defineProperty;var P=(d,e,t)=>e in d?A(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var h=(d,e,t)=>P(d,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/*!
* metismenujs - v1.4.0
* MetisMenu: Collapsible menu plugin with Vanilla-JS
* https://github.com/onokumus/metismenujs#readme
*
* Made by Osman Nuri Okumus <onokumus@gmail.com> (https://github.com/onokumus)
* Under MIT License
*/const x={parentTrigger:"li",subMenu:"ul",toggle:!0,triggerElement:"a"},p={ACTIVE:"mm-active",COLLAPSE:"mm-collapse",COLLAPSED:"mm-collapsed",COLLAPSING:"mm-collapsing",METIS:"metismenu",SHOW:"mm-show"};class y{constructor(e,t){this.element=y.isElement(e)?e:document.querySelector(e),this.config=Object.assign(Object.assign({},x),t),this.disposed=!1,this.triggerArr=[],this.boundEventHandler=this.clickEvent.bind(this),this.init()}static attach(e,t){return new y(e,t)}init(){const{METIS:e,ACTIVE:t,COLLAPSE:o}=p;this.element.classList.add(e);const s=[...this.element.querySelectorAll(this.config.subMenu)];s.length!==0&&s.forEach(i=>{i.classList.add(o);const r=i.closest(this.config.parentTrigger);r!=null&&r.classList.contains(t)?this.show(i):this.hide(i);const n=r==null?void 0:r.querySelector(this.config.triggerElement);(n==null?void 0:n.getAttribute("aria-disabled"))!=="true"&&(n==null||n.setAttribute("aria-expanded","false"),n==null||n.addEventListener("click",this.boundEventHandler),this.triggerArr.push(n))})}clickEvent(e){if(!this.disposed){const t=e==null?void 0:e.currentTarget;t&&t.tagName==="A"&&e.preventDefault();const o=t.closest(this.config.parentTrigger),s=o==null?void 0:o.querySelector(this.config.subMenu);this.toggle(s)}}update(){this.disposed=!1,this.init()}dispose(){this.triggerArr.forEach(e=>{e.removeEventListener("click",this.boundEventHandler)}),this.disposed=!0}on(e,t,o){return this.element.addEventListener(e,t,o),this}off(e,t,o){return this.element.removeEventListener(e,t,o),this}emit(e,t,o=!1){const s=new CustomEvent(e,{bubbles:o,detail:t});this.element.dispatchEvent(s)}toggle(e){const t=e.closest(this.config.parentTrigger);t!=null&&t.classList.contains(p.ACTIVE)?this.hide(e):this.show(e)}show(e){var t;const o=e,{ACTIVE:s,COLLAPSE:i,COLLAPSED:r,COLLAPSING:n,SHOW:l}=p;if(this.isTransitioning||o.classList.contains(n))return;const a=()=>{o.classList.remove(n),o.style.height="",o.removeEventListener("transitionend",a),this.setTransitioning(!1),this.emit("shown.metisMenu",{shownElement:o})},c=o.closest(this.config.parentTrigger);c==null||c.classList.add(s);const u=c==null?void 0:c.querySelector(this.config.triggerElement);u==null||u.setAttribute("aria-expanded","true"),u==null||u.classList.remove(r),o.style.height="0px",o.classList.remove(i),o.classList.remove(l),o.classList.add(n);const g=[].slice.call((t=c==null?void 0:c.parentNode)===null||t===void 0?void 0:t.children).filter(m=>m!==c);this.config.toggle&&g.length>0&&g.forEach(m=>{const f=m.querySelector(this.config.subMenu);f&&this.hide(f)}),this.setTransitioning(!0),o.classList.add(i),o.classList.add(l),o.style.height=`${o.scrollHeight}px`,this.emit("show.metisMenu",{showElement:o}),o.addEventListener("transitionend",a)}hide(e){const{ACTIVE:t,COLLAPSE:o,COLLAPSED:s,COLLAPSING:i,SHOW:r}=p,n=e;if(this.isTransitioning||!n.classList.contains(r))return;this.emit("hide.metisMenu",{hideElement:n});const l=n.closest(this.config.parentTrigger);l==null||l.classList.remove(t);const a=()=>{n.classList.remove(i),n.classList.add(o),n.style.height="",n.removeEventListener("transitionend",a),this.setTransitioning(!1),this.emit("hidden.metisMenu",{hiddenElement:n})};n.style.height=`${n.getBoundingClientRect().height}px`,n.style.height=`${n.offsetHeight}px`,n.classList.add(i),n.classList.remove(o),n.classList.remove(r),this.setTransitioning(!0),n.addEventListener("transitionend",a),n.style.height="0px";const c=l==null?void 0:l.querySelector(this.config.triggerElement);c==null||c.setAttribute("aria-expanded","false"),c==null||c.classList.add(s)}setTransitioning(e){this.isTransitioning=e}static isElement(e){return!!e.classList}}function L(d){return new Promise((e,t)=>{if(document.querySelector(`link[href="${d}"]`))return e();const o=document.createElement("link");o.rel="stylesheet",o.href=d,o.onload=()=>e(),o.onerror=()=>t(new Error(`Failed to load CSS: ${d}`)),document.head.appendChild(o)})}function O(d){return new Promise((e,t)=>{if(document.querySelector(`script[src="${d}"]`))return e();const o=document.createElement("script");o.src=d,o.async=!0,o.onload=()=>e(),o.onerror=()=>t(new Error(`Failed to load script: ${d}`)),document.head.appendChild(o)})}class k{constructor(){h(this,"name");h(this,"instance",null)}async initialize(e,t){await L("https://cdn.jsdelivr.net/npm/metismenujs/dist/metismenujs.min.css"),await O("https://cdn.jsdelivr.net/npm/metismenujs/dist/metismenujs.min.js"),await L(`/themes/${t}/menu-systems/metismenu.css`);const o=document.getElementById(e);if(!o)return;const s=o.querySelector("ul.cd-menu-root");s&&(this.transformForMetisMenu(s),this.instance=new y("#menu"))}destroy(){}transformForMetisMenu(e){e.classList.remove("cd-menu-root"),e.classList.add("metismenu"),e.setAttribute("id","menu"),e.querySelectorAll(".cd-menu-item").forEach(t=>{const o=t.querySelector(".cd-menu-label"),s=t.getAttribute("data-route")||"#",i=t.getAttribute("data-icon"),r=t.querySelector("ul");let n=null;if(i)try{const l=atob(i);n=JSON.parse(l)}catch(l){console.warn("Failed to decode or parse icon metadata",l)}if(o){const l=document.createElement("a");if(l.href=r?"#":`/${s}`,l.classList.add("menu-link"),n){const c=this.createIconElement(n);c&&(c.classList.add("menu-icon"),l.appendChild(c))}const a=document.createElement("span");if(a.textContent=o.textContent||"",l.appendChild(a),r){l.classList.add("has-arrow"),l.setAttribute("aria-expanded","false");const c=document.createElement("i");c.classList.add("menu-arrow","fa-solid","fa-chevron-right"),l.appendChild(c)}o.replaceWith(l)}t.classList.remove("cd-menu-item")}),e.querySelectorAll("ul.cd-submenu").forEach(t=>{t.classList.remove("cd-submenu")})}createIconElement(e){if(!e.iconType)return null;const t=this.getCurrentThemeMenu(),o=(t==null?void 0:t.iconSize)??14,s=(t==null?void 0:t.iconColor)??"#444";switch(e.iconType){case"fontawesome":{const i=document.createElement("i");return i.className=e.icon,i.style.color=s,i.style.fontSize=`${o}px`,i}case"svg":{const i=document.createElement("span");i.innerHTML=e.icon;const r=i.firstElementChild;return r&&(r.style.color=s,r.style.width=`${o}px`,r.style.height=`${o}px`),r}case"string":{const i=document.createElement("span");return i.textContent=e.icon,i.style.color=s,i.style.fontSize=`${o}px`,i}default:return null}}getCurrentThemeMenu(){var e,t;try{const o=localStorage.getItem("cd-theme"),s=o?JSON.parse(o):null;return(t=(e=s==null?void 0:s.layout)==null?void 0:e.sidebar)==null?void 0:t.menu}catch{return}}}class I{constructor(){h(this,"currentAdapter",null)}renderMenuWithSystem(e,t,o="cd-sidebar"){var r,n,l,a;this.renderPlainMenu(e,o);const s=((l=(n=(r=t==null?void 0:t.layout)==null?void 0:r.sidebar)==null?void 0:n.menu)==null?void 0:l.menuSystem)||"plain",i=this.menuAdapterFactory(s);(a=this.currentAdapter)!=null&&a.destroy&&this.currentAdapter.destroy(),i&&(i.initialize(o,t.id),this.currentAdapter=i)}renderPlainMenu(e,t="sidebar",o){const s=document.getElementById(t);s&&(s.innerHTML=`<ul class="cd-menu-root">${this.renderMenuHtml(e)}</ul>`,this.attachClickHandlers(s,e,o))}attachClickHandlers(e,t,o){const s=e.querySelectorAll(".cd-menu-item");this.walkMenu(t,e,s,0,o)}walkMenu(e,t,o,s,i){var r;for(const n of e){const l=o[s++];l&&l.addEventListener("click",a=>{a.stopPropagation(),this.onMenuClick(n,i)}),(r=n.children)!=null&&r.length&&this.walkMenu(n.children,l,o,s,i)}}onMenuClick(e,t){if(e.itemType==="action"&&e.action){e.action();return}if(e.itemType==="template"&&e.template){this.loadResource({cdToken:t,item:e});return}e.itemType==="route"&&e.route&&e.route&&(window.location.hash=e.route)}loadResource(e={}){var s,i;const{cdToken:t,item:o}=e;if(o!=null&&o.template){const r=typeof o.template=="function"?o.template():o.template,n=document.getElementById("cd-main-content");if(n){n.innerHTML=r;const l=o.controller;l!=null&&l.__setup&&typeof l.__setup=="function"&&l.__setup()}}(i=(s=window.cdShell)==null?void 0:s.lifecycle)!=null&&i.onViewLoaded&&window.cdShell.lifecycle.onViewLoaded(o,t)}renderMenuHtml(e){return e.map(t=>{const o=t.children&&t.children.length>0,s=t.route||"",i=t.icon?btoa(JSON.stringify(t.icon)):"";return`
        <li 
          class="cd-menu-item" 
          data-route="${s}" 
          ${i?`data-icon="${i}"`:""}
        >
          <span class="cd-menu-label">${t.label}</span>
          ${o?`<ul class="cd-submenu">${this.renderMenuHtml(t.children)}</ul>`:""}
        </li>
      `}).join("")}menuAdapterFactory(e){switch(e){case"metismenu":return new k;case"plain":default:return null}}}class T{constructor(e={}){h(this,"context");h(this,"level");h(this,"silent");this.context=e.context||"Shell",this.level=e.level||"debug",this.silent=e.silent||!1}shouldLog(e){const t={debug:0,info:1,warn:2,error:3};return t[e]>=t[this.level]}log(e,t,...o){if(this.silent||!this.shouldLog(e))return;const s=`[${this.context.toUpperCase()}] [${e.toUpperCase()}]`;switch(e){case"debug":console.debug(s,t,...o);break;case"info":console.info(s,t,...o);break;case"warn":console.warn(s,t,...o);break;case"error":console.error(s,t,...o);break}}debug(e,...t){this.log("debug",e,...t)}info(e,...t){this.log("info",e,...t)}warn(e,...t){this.log("warn",e,...t)}error(e,...t){this.log("error",e,...t)}setContext(e){this.context=e}setLevel(e){this.level=e}silence(){this.silent=!0}unsilence(){this.silent=!1}}class M{static setActiveTheme(e){this.currentTheme=e}static get layout(){var e;return((e=this.currentTheme)==null?void 0:e.layout)||{}}async loadThemeConfig(){console.debug("ThemeService::loadThemeConfig(): 01");const e=await fetch("/themes/default/theme.json");if(console.debug("ThemeService::loadThemeConfig(): 01"),console.debug("ThemeService::loadThemeConfig()/res:",e),!e.ok)throw console.debug("ThemeService::loadThemeConfig(): 02"),new Error(`ThemeService::loadThemeConfig:Failed to load shell config: ${e.statusText}`);return console.debug("ThemeService::loadThemeConfig(): 03"),e.json()}}h(M,"currentTheme");const _={accessibleThemes:["default","dark","contrast"]},j={themeConfig:_};class z{async loadTheme(e="default"){console.debug("loadTheme(): loading theme ID:",e);const t=`/themes/${e}/theme.json`,o=await fetch(t);if(!o.ok){const r=await o.text();throw new Error(`Theme fetch failed: ${o.status} ${o.statusText}. Body: ${r}`)}const s=await o.json();if(!j.themeConfig.accessibleThemes.includes(e))throw new Error(`Theme "${e}" is not accessible as per shell configuration.`);if(s.authorizationGuid&&!this.isAuthorized(s.authorizationGuid))throw new Error(`User is not authorized to use theme: ${s.name}`);this.applyTheme("default",s),console.debug("Theme loaded successfully:",e)}isAuthorized(e){return!0}applyTheme(e,t){var r;if(!((r=t.layout.sidebar)!=null&&r.visible)){const n=document.getElementById("cd-sidebar");n&&(n.style.display="none")}Object.entries(t.colors).forEach(([n,l])=>{document.documentElement.style.setProperty(`--cd-${n}-color`,l)}),document.body.style.fontFamily=t.font||"sans-serif";const o=document.getElementById("cd-logo");o&&t.logo&&(o.src=t.logo);const s=document.getElementById("theme-css"),i=`/themes/${e}/theme.css`;if(s)s.href=i;else{const n=document.createElement("link");n.id="theme-css",n.rel="stylesheet",n.href=i,document.head.appendChild(n)}document.body.className="",document.body.classList.add(`theme-${e}`)}}const N="modulepreload",B=function(d){return"/"+d},S={},v=function(e,t,o){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),n=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=B(l),l in S)return;S[l]=!0;const a=l.endsWith(".css"),c=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":N,a||(u.as="script"),u.crossOrigin="",u.href=l,n&&u.setAttribute("nonce",n),document.head.appendChild(u),a)return new Promise((g,m)=>{u.addEventListener("load",g),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(r){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=r,window.dispatchEvent(n),!n.defaultPrevented)throw r}return s.then(r=>{for(const n of r||[])n.status==="rejected"&&i(n.reason);return e().catch(i)})};let V,b,C;const q=async()=>{if(console.log("starting initializeNodeModules()-01"),typeof window>"u"){console.log("initializeNodeModules()-02");try{const[d,e,t]=await Promise.all([v(()=>import("./__vite-browser-external-D7Ct-6yo.js").then(o=>o._),[]),v(()=>import("./__vite-browser-external-D7Ct-6yo.js").then(o=>o._),[]),v(()=>import("./url-Dd-DREE4.js").then(o=>o.u),__vite__mapDeps([0,1]))]);console.log("initializeNodeModules()-03"),V=d,b=e,C=t}catch(d){console.log("initializeNodeModules()-04"),console.error("[ModuleService] Failed to load Node.js modules:",d)}}},E=class E{constructor(){h(this,"logger",new T);h(this,"modules",{});this.logger.debug("[ModuleService][constructor]: starting"),this.isViteMode?(this.logger.debug("[ModuleService] isViteMode=true"),this.modules=Object.assign({"/src/CdShell/sys/cd-user/view/index.js":()=>v(()=>import("./index-CEg3yTG6.js"),[])}),this.logger.debug("[ModuleService] Running under Vite (browser).")):this.logger.debug("[ModuleService] Running under Node (non-Vite).")}get isBrowser(){return typeof window<"u"}get isViteMode(){return this.isBrowser}get baseDir(){return this.isViteMode?"/src/CdShell":b==null?void 0:b.resolve(process.cwd(),"dist-ts/CdShell")}static async ensureInitialized(){return console.log("[ModuleService][ensureInitialized]: starting"),this.initPromise||(this.initPromise=q()),this.initPromise}async loadModule(e,t){var l;await E.ensureInitialized(),this.logger.debug("ModuleService::loadModule()/01:");const o=this.isViteMode,s=this.baseDir,i=o?`src/CdShell/${e}/${t}/view/index.js`:`${s}/${e}/${t}/view/index.js`;if(this.logger.debug("[ModuleService] expectedPathFragment:",i),o){const a=Object.keys(this.modules).find(c=>c.replace(/^\.?\//,"")===i);if(!a)throw console.error("[ModuleService] Available module keys:",Object.keys(this.modules)),new Error(`[ModuleService] Module not found for ctx=${e}, moduleId=${t}`);try{const c=this.modules[a],g=(await c()).module;if(!g)throw new Error(`Missing 'module' export in: ${a}`);const m=document.getElementById("cd-main-content");m&&(m.innerHTML=g.template),(l=g.controller)!=null&&l.__setup&&g.controller.__setup();const f=new Date;return console.log(`[ModuleService] Loaded '${t}' (Vite mode) at ${f.toLocaleDateString()} ${f.toLocaleTimeString()}`),g}catch(c){throw console.error("[ModuleService] Browser import failed:",c),c}}const n=`${s.replace(/\\/g,"/").replace(/\/+$/,"")}/${e}/${t}/view/index.js`;this.logger.debug("[ModuleService] Importing (Node):",n);try{const c=await import(C.pathToFileURL(n).href),u=new Date;return console.log(`[ModuleService] Loaded '${t}' (Node mode) at ${u.toLocaleDateString()} ${u.toLocaleTimeString()}`),c.module}catch(a){throw console.error("[ModuleService] Node import failed:",a),a}}};h(E,"initPromise",null);let w=E;class H{constructor(){h(this,"svModule");h(this,"svMenu");h(this,"svTheme");h(this,"svThemeLoader");h(this,"logger",new T)}async init(){this.logger.debug("[Main] init(): starting"),typeof window>"u"?(this.logger.debug("[Main] Running in Node → awaiting ensureInitialized()"),await w.ensureInitialized()):this.logger.debug("[Main] Running in browser → skipping ensureInitialized()"),this.svModule=new w,this.svMenu=new I,this.svTheme=new M,this.svThemeLoader=new z;const e=await this.loadShellConfig();e.logLevel&&this.logger.setLevel(e.logLevel),this.logger.debug("[Main] init(): completed")}async run(){this.logger.setLevel("debug"),this.logger.debug("starting bootstrapShell()"),this.logger.debug("bootstrapShell()/01:");const e=await this.loadShellConfig();this.logger.debug("bootstrapShell()/02:"),e.logLevel&&this.logger.setLevel(e.logLevel),this.logger.debug("bootstrapShell()/03:");const t=await this.svTheme.loadThemeConfig();this.logger.debug("bootstrapShell()/04:"),this.logger.debug("bootstrapShell()/themeConfig:",t),document.title=e.appName||e.fallbackTitle||"Corpdesk",this.logger.debug("bootstrapShell()/05:");const o=document.getElementById("cd-logo");if(this.logger.debug("bootstrapShell()/06:"),o&&t.logo&&(o.src=t.logo),this.logger.debug("bootstrapShell()/07:"),t.colors.primary&&document.documentElement.style.setProperty("--theme-color",t.colors.primary),this.logger.debug("bootstrapShell()/08:"),e.defaultModulePath){this.logger.debug("bootstrapShell()/09:");const[n,l]=e.defaultModulePath.split("/");this.logger.debug("bootstrapShell()/ctx:",n),this.logger.debug("bootstrapShell()/moduleId:",l),this.logger.debug("bootstrapShell()/10:");const a=await this.svModule.loadModule(n,l);if(a.menu){this.logger.debug("Main::loadModule()/menu:",a.menu);const c=await fetch(e.themeConfig.currentThemePath);if(!c.ok){const g=await c.text();throw new Error(`Theme fetch failed: ${c.status} ${c.statusText}. Body: ${g}`)}const u=await c.json();this.logger.debug("Main::loadModule()/theme:",u),this.svMenu.renderMenuWithSystem(a.menu,u)}else this.logger.debug("Main::loadModule()/no menu to render");this.logger.debug("bootstrapShell()/11:")}this.svThemeLoader.loadTheme("default");const s=document.getElementById("cd-burger"),i=document.getElementById("cd-sidebar"),r=document.getElementById("cd-overlay");s.addEventListener("click",()=>{i.classList.toggle("open"),r.classList.toggle("hidden")}),r.addEventListener("click",()=>{i.classList.remove("open"),r.classList.add("hidden")})}async loadShellConfig(){const e=await fetch("/shell.config.json");if(!e.ok)throw new Error(`Failed to load shell config: ${e.statusText}`);return await e.json()}}console.log("start 1");const $=new H;$.init();$.run().catch(d=>{console.error("[BOOTSTRAP ERROR]",d)});
