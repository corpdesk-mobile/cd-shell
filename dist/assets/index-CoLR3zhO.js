import{c as v,U as m,C as d,S as r,a as h,u}from"./index-C5uXBrf-.js";import{C as S,a as p,b as f,c as y}from"./cd-directive-binder.service-DGbLY5eG.js";class C{constructor(e){var i;this.activeUiSystemId=((i=v.defaultUiConfig)==null?void 0:i.defaultUiSystemId)||"bootstrap-538",this.activeThemePath="/themes/bootstrap-502/default.json",this.logLevel="debug",Object.assign(this,e)}}const A=[{id:"standard",name:"Standard"},{id:"compact",name:"Compact"},{id:"floating",name:"Floating Labels"}];class b{constructor(e){this.sysCache=e,this.config=new C,this.uiSystemLoader=new m(this.sysCache)}getConfig(){return this.config}saveConfig(e){return console.log("[AdminService] Attempting to save configuration:",e),Object.assign(this.config,e),Promise.resolve()}generateUiSystemOptions(e){console.log("[CdAdminService][generateUiSystemOptions] start");const i=this.uiSystemLoader.list();let n='<option value="">-- Select UI System --</option>';return console.log("[CdAdminService][generateUiSystemOptions] optionsHtml",n),!i||i.length===0?'<option value="">-- No UI Systems Available --</option>':(i.forEach(o=>{const a=o.id===e?"selected":"";n+=`<option value="${o.id}" ${a}>${o.name||o.id}</option>`}),console.log("[CdAdminService][generateUiSystemOptions] optionsHtml",n),n)}generateThemeOptions(e,i){const n=this.uiSystemLoader.getSystemById(e),o=n==null?void 0:n.themesAvailable;if(!n||!o||o.length===0)return'<option value="">-- No Themes Available --</option>';let a='<option value="">-- Select Theme --</option>';return o.forEach(l=>{const c=l.id===i?"selected":"";a+=`<option value="${l.id}" ${c}>${l.name}</option>`}),a}generateFormVariantOptions(e){const i=A;let n='<option value="">-- Select Form Variant --</option>';return i.forEach(o=>{const a=o.id===e?"selected":"";n+=`<option value="${o.id}" ${a}>${o.name}</option>`}),n}}const w={form:null,binder:null,uiSystemLoader:null,uiThemeLoader:null,svCdAdmin:null,currentUiSystemId:"",svConfig:null,__init(){console.log("[ctlCdAdminSettings][__init] start..."),this.svConfig=new d;const t=r.getInstance(this.svConfig),e=m.getInstance(t),i=h.getInstance(t);t.setLoaders(e,i),this.uiSystemLoader=t.uiSystemLoader??null,this.uiThemeLoader=t.uiThemeLoader??null,this.svCdAdmin=new b(t),this.form=new S({uiSystem:new p("",[f.required("Select UI System")]),theme:new p("",[f.required("Select Theme")]),formType:new p("",[f.required("Select Form Type")])}),this.binder=new y(this.form,"#settingsForm",this)},__template(){return console.log("[ctlCdAdminSettings][__template] start..."),`
      <form id="settingsForm" class="cd-form">
        <div class="cd-form-field">
          <label for="uiSystem">UI System</label>
          <select id="uiSystem" name="uiSystem" cdFormControl (change)="onUiSystemChange($event)">
            ${this.uiSystemOptionsHtml}
          </select>
        </div>

        <div class="cd-form-field">
          <label for="theme">Theme</label>
          <select id="theme" name="theme" cdFormControl (change)="onThemeChange($event)">
            ${this.themeOptionsHtml}
          </select>
        </div>

        <div class="cd-form-field">
          <label for="formType">Form Variant</label>
          <select id="formType" name="formType" cdFormControl (change)="onFormVariantChange($event)">
            ${this.formVariantOptionsHtml}
          </select>
        </div>

        <button cdButton>Apply Settings</button>
      </form>
    `},get uiSystemOptionsHtml(){console.log("[ctlCdAdminSettings][uiSystemOptionsHtml] start..."),this.svConfig=new d;const t=r.getInstance(this.svConfig),e=m.getInstance(t),i=h.getInstance(t);t.setLoaders(e,i);const n=t.get("uiSystems")||[];return console.log("[ctlCdAdminSettings][uiSystemOptionsHtml] uiSystemsRaw:",u.inspect(n,{depth:2})),n.length?`<option value="">-- Select UI System --</option>${n.map(a=>{const l=a.id||a.name||a.displayName||"Unnamed UI System";return`<option value="${a.id}">${l}</option>`}).join("")}`:'<option value="">-- No UI Systems Found --</option>'},get themeOptionsHtml(){console.log("[ctlCdAdminSettings][themeOptionsHtml] start..."),this.svConfig=new d;const e=r.getInstance(this.svConfig).getThemes();console.log("[ctlCdAdminSettings][themeOptionsHtml] themes:",u.inspect(e,{depth:2}));const i=Array.isArray(e)?e:(e==null?void 0:e.themes)||[];return i.length?`<option value="">-- Select Theme --</option>${i.map(o=>`<option value="${o.id}">${o.displayName??o.name}</option>`).join("")}`:'<option value="">-- No Themes Available --</option>'},get formVariantOptionsHtml(){console.log("[ctlCdAdminSettings][formVariantOptionsHtml] start..."),this.svConfig=new d;const e=r.getInstance(this.svConfig).getFormVariants();return console.log("[ctlCdAdminSettings][formVariantOptionsHtml] variants:",u.inspect(e,{depth:2})),e.length?`<option value="">-- Select Variant --</option>${e.map(n=>`<option value="${n.id}">${n.displayName??n.name}</option>`).join("")}`:'<option value="">-- No Variants --</option>'},async __setup(){console.log("[ctlCdAdminSettings][__setup] start..."),this.svConfig=new d,await r.getInstance(this.svConfig).ensureReady()},async __activate(){var t;console.log("[ctlCdAdminSettings][__activate] start..."),(t=this.binder)!=null&&t.bindToDom&&await this.binder.bindToDom()},async __afterInit(){var l;console.log("[ctlCdAdminSettings][__afterInit] start...");const t=this.form.controls;this.svConfig=new d;const e=r.getInstance(this.svConfig),i=e.getUiSystems(),n=e.getThemes(),o=Array.isArray(n)?n:(n==null?void 0:n.themes)||[],a=e.getFormVariants();i.length&&t.uiSystem.setValue(i[0].id),o.length&&t.theme.setValue(o[0].id),a.length&&t.formType.setValue(a[0].id),(l=this.binder)!=null&&l.refreshView&&this.binder.refreshView(),console.log("[ctlCdAdminSettings][__afterInit] end.")},__deactivate(){var t;console.log("[ctlCdAdminSettings][__deactivate]"),(t=this.binder)!=null&&t.unbindAllDomEvents&&this.binder.unbindAllDomEvents()},async onUiSystemChange(t){try{const e=t&&t.target&&t.target.value||t;if(!e){console.warn("[ctlCdAdminSettings.onUiSystemChange] empty selection");return}console.log("ðŸ§© UI System change requested:",e);const i=new d,n=r.getInstance(i),o=m.getInstance(n),a=h.getInstance(n);await o.activate(e),console.log("[ctlCdAdminSettings] ui-system activated:",e);const l=o.getSystemById(e)||o.getActive();let c=null;if(l&&l.themesAvailable&&l.themesAvailable.length>0){const s=l.themesAvailable.find(g=>g.default||g.id==="default"||g.name==="Default");c=s?s.id||s.name:l.themesAvailable[0].id}c||(c="default");try{await o.applyTheme(e,c),console.log("[ctlCdAdminSettings] theme applied:",c)}catch(s){console.warn("[ctlCdAdminSettings] applyTheme failed, continuing",s)}try{const s=await i.loadConfig();s.uiConfig=s.uiConfig||{},s.uiConfig.defaultUiSystemId=e,s.uiConfig.defaultThemeId=c,await i.saveConfig(s),console.log("[ctlCdAdminSettings] persisted uiConfig",{newSystemId:e,themeId:c})}catch(s){console.warn("[ctlCdAdminSettings] failed to persist config",s)}try{const s=new CustomEvent("cd:ui-system:changed",{detail:{systemId:e,themeId:c},bubbles:!0});document.dispatchEvent(s),console.log("[ctlCdAdminSettings] dispatched cd:ui-system:changed")}catch(s){console.warn("[ctlCdAdminSettings] event dispatch failed",s)}try{window.CdDirectiveBinderService&&typeof window.CdDirectiveBinderService.bindToDom=="function"?(window.CdDirectiveBinderService.bindToDom(document.body),console.log("[ctlCdAdminSettings] CdDirectiveBinderService.bindToDom triggered")):window.CdDirectiveBinderServiceInstance&&typeof window.CdDirectiveBinderServiceInstance.bindToDom=="function"&&window.CdDirectiveBinderServiceInstance.bindToDom(document.body)}catch(s){console.warn("[ctlCdAdminSettings] binder re-run failed",s)}}catch(e){console.error("[ctlCdAdminSettings.onUiSystemChange] uncaught error",e)}},async onThemeChange(t){console.log("ðŸŽ¨ Theme changed:",t.target.value)},async onFormVariantChange(t){console.log("ðŸ§± Form Variant changed:",t.target.value)}},T={ctx:"sys",moduleId:"cd-admin",moduleName:"cd-admin",moduleGuid:"aaaa-bbbb-cccc-dddd",controllers:[{name:"settings",instance:w,template:function(){return typeof this.__template=="function"?this.__template():(console.warn("[cdAdminModule] Missing __template() on controller:",this),"<div>Template not available.</div>")},default:!1}],menu:[{label:"cd-admin",route:"sys/cd-admin",children:[{label:"settings",itemType:"route",route:"sys/cd-admin/settings",template:function(){return typeof this.__template=="function"?this.__template():(console.warn("[Menu][cd-admin/settings] Missing __template()"),"<div>Template missing for cd-admin/settings.</div>")}}]}]},U=T;export{T as cdAdminModule,U as module};
